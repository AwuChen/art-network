<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WASHI Network Visualization</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #dropdown-container {
      margin: 10px;
    }
  </style>

  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/react-force-graph-2d"></script>
</head>

<body>
  <center><div id="dropdown-container"></div></center>
  <div id="graph" style="z-index: 1;"></div>

  <script type="text/jsx">
    const App = () => {
  const [graphData, setGraphData] = React.useState({ nodes: [], links: [] });
  const graphRef = React.useRef();

  // Function to add a new node and connect it to the last added node
  const addNewNode = () => {
    setGraphData((prevData) => {
      const newNode = {
        id: `Node-${prevData.nodes.length + 1}`,
        color: "blue",
        size: 6
      };
      const updatedNodes = [...prevData.nodes, newNode];
      const updatedLinks = prevData.nodes.length > 0 ?
        [...prevData.links, { source: newNode.id, target: prevData.nodes[prevData.nodes.length - 1].id }] :
        prevData.links;
      return { nodes: updatedNodes, links: updatedLinks };
    });
  };

  React.useEffect(() => {
    // Check for NFC tap event (e.g., query parameter in URL)
    const params = new URLSearchParams(window.location.search);
    if (params.has("nfc")) {
      addNewNode();
    }
  }, []);

  return (
    <ForceGraph2D
      graphData={graphData}
      nodeAutoColorBy="group"
      nodeLabel={(node) => node.id}
      linkDirectionalArrowRelPos={1}
      linkDirectionalArrowLength={5}
      nodeCanvasObject={(node, ctx) => {
        ctx.fillStyle = node.color;
        ctx.beginPath();
        ctx.arc(node.x, node.y, node.size, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = "black";
        ctx.fillText(node.id, node.x + 10, node.y);
      }}
    />
  );
};

ReactDOM.render(<App />, document.getElementById("graph"));
  </script>
</body>
</html>
