<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WASHI Network Visualization</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #dropdown-container {
      margin: 10px;
    }
  </style>

  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/react-force-graph-2d"></script>
</head>

<body>
  <center><div id="dropdown-container"></div></center>
  <div id="graph" style="z-index: 1;"></div>

  <script type="text/jsx">
    const App = () => {
      const [graphData, setGraphData] = React.useState({ nodes: [], links: [] });
      const graphRef = React.useRef();

      React.useEffect(() => {
        fetch("datasets/kyoto_craft_private.json")
          .then((res) => res.json())
          .then((data) => setGraphData(data));
      }, []);

      // Function to add a new node when NFC card is tapped
      const addNewNode = (newNode) => {
        setGraphData((prevData) => {
          const updatedNodes = [...prevData.nodes, newNode];
          const updatedLinks = [
            ...prevData.links,
            { source: newNode.id, target: "Existing Node", value: 5 }, // Example link
          ];
          return { nodes: updatedNodes, links: updatedLinks };
        });
      };

      React.useEffect(() => {
        // Check for NFC tap event (e.g., query parameter in URL)
        const params = new URLSearchParams(window.location.search);
        if (params.has("nfc")) {
          const newNode = {
            id: `User-${Date.now()}`,
            group: 1,
            color: "blue",
            size: 6,
            type: "NFC User",
            website: "#"
          };
          addNewNode(newNode);
        }
      }, []);

      return (
        <ForceGraph2D
          ref={graphRef}
          graphData={graphData}
          nodeAutoColorBy="group"
          nodeLabel={(node) => `${node.id} (${node.type})`}
          linkDirectionalArrowRelPos={1}
          linkDirectionalArrowLength={5}
          nodeCanvasObject={(node, ctx) => {
            ctx.fillStyle = node.color;
            ctx.beginPath();
            ctx.arc(node.x, node.y, node.size, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = "black";
            ctx.fillText(node.id, node.x + 10, node.y);
          }}
        />
      );
    };

    ReactDOM.render(<App />, document.getElementById("graph"));
  </script>
</body>
</html>
