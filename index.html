<head>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #dropdown-container {
      margin: 10px;
    }
  </style>

  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://unpkg.com/react-force-graph-2d"></script>
</head>

<body>
  <div id="dropdown-container"></div>
  <div id="graph" style="z-index: 1;"></div>
  <script type="text/jsx">
    const App = () => {
      const [dataset, setDataset] = React.useState('datasets/art_basel.json');
      const [hoveredNode, setHoveredNode] = React.useState(null); // Track hovered node
      const graphRef = React.useRef();

      const handleDatasetChange = (event) => {
        setDataset(event.target.value);
      };

      React.useEffect(() => {
        fetch(dataset).then(res => res.json()).then(data => {

          ReactDOM.render(
          <ForceGraph2D
          ref={graphRef}
          graphData={data}
          nodeAutoColorBy="group"
          nodeLabel={node => `${node.id} (${node.type})`}
          linkWidth="value"
          linkDirectionalArrowRelPos={1}
          linkDirectionalArrowLength={5}
          linkCurvature={0.2}
          onNodeHover={(node) => setHoveredNode(node)} // Track hovered node
          onEngineTick={() => {
            if (graphRef.current) {
              graphRef.current.d3Force('collide', node => Math.sqrt(node.size) + 10);
            }
          }}
          nodeCanvasObject={(node, ctx, globalScale) => {
            const label = node.id;
            const fontSize = Math.max(8, node.size / 2);
            ctx.font = `${fontSize}px Sans-Serif`;

            // Draw node circle
            ctx.fillStyle = node.color;
            ctx.beginPath();
            ctx.arc(node.x, node.y, node.size / 2, 0, 2 * Math.PI, false);
            ctx.fill();

            // Draw institution name
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
            ctx.fillText(label, node.x, node.y - fontSize - 5);

            // Highlight hovered node's details
            if (hoveredNode === node) {
              const artistFontSize = fontSize * 0.7;
              ctx.font = `${artistFontSize}px Sans-Serif`;
              ctx.fillStyle = 'black';
              const artistInfo = node.artists
              ? node.artists
              .slice(0, 3)
              .map(a => `${a.name} (${a.style})`)
              .join(', ')
              : 'No artist data';
              ctx.fillText(artistInfo, node.x, node.y + fontSize + 10); // Below the node
            }
          }}
          />,
          document.getElementById('graph')
          );
        });
      }, [dataset, hoveredNode]); // Re-render on dataset or hover change

      return (
      <div id="dropdown-container">
        <label htmlFor="dataset-select" style={{ marginRight: "10px" }}>Select Dataset:</label>
        <select value={dataset} onChange={handleDatasetChange}>
          <option value="datasets/northeastern.json">Northeastern</option>
          <option value="datasets/art_basel.json">Art Basel</option>
          <option value="datasets/kyoto_craft_private.json">Kyoto Craft</option>
        </select>
      </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('dropdown-container'));
  </script>
</body>